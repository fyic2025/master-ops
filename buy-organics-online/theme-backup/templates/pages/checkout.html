{{#partial "head"}}

{{{ checkout.checkout_head }}}
{{{ stylesheet '/assets/css/optimized-checkout.css' }}}
{{ getFontsCollection }}

<script type="text/javascript">
    window.language = {{{langJson 'optimized_checkout'}}};
</script>
{{{head.scripts}}}

{{/partial}}

{{#partial "page"}}
<header class="checkoutHeader optimizedCheckout-header">
    <div class="checkoutHeader-content">
        <h1 class="is-srOnly">{{lang 'checkout.title'}}</h1>
        <h2 class="checkoutHeader-heading">
            <a class="checkoutHeader-link" href="{{urls.home}}">
                {{#if checkout.header_image}}
                    <img alt="{{settings.store_logo.title}}" class="checkoutHeader-logo" id="logoImage" src="{{ checkout.header_image }}"/>
                {{ else }}
                    <span class="header-logo-text">{{settings.store_logo.title}}</span>
                {{/if}}
            </a>
        </h2>
    </div>
</header>

{{{ checkout.checkout_content }}}

{{{ footer.scripts }}}
<style type="text/css">
    .form-checklist-item.optimizedCheckout-form-checklist-item:first-child .paymentProviderHeader-cc .creditCardTypes-list-item:nth-child(3), .form-checklist-item.optimizedCheckout-form-checklist-item:first-child .paymentProviderHeader-cc .creditCardTypes-list-item:nth-child(4) {
    	display: none !important;
    }

</style>
<script type="text/javascript">
    var get_format_msg = '<p class="mobile_num_con">Mobile number with the country code, e.g., +61.</p>';
    $(document).on('keyup', '#field_27', function(event) {
        if($(this).parent().find('.mobile_num_con').length === 0) {
            $(this).after(get_format_msg);
        }
    });     
    $(document).on('submit', '#checkout-customer-returning', function(event) {
        var mobileNumber = $('#field_27').val();
        var phonePattern = /^\+?[1-9]\d{1,14}$/; // E.164 format validation
        
        if (!phonePattern.test(mobileNumber)) {
            event.preventDefault(); // Prevent form submission
            alert('Please enter a valid mobile number.'); // Alert user
            $('#field_27').focus(); // Focus on the mobile number field

            // Check if the clone button already exists
            if ($('#checkout-customer-create_clone').length === 0) {
                // Clone the Create Account button and modify it
                var cloneButton = $('<button>', {
                    id: 'checkout-customer-create_clone',
                    class: 'button button--primary optimizedCheckout-buttonPrimary',
                    text: 'Create Account',
                    type: 'button', // Ensure it's not of type submit
                });
                
                // Insert the cloned button after the original one
                $('#checkout-customer-create').after(cloneButton);
                $('#checkout-customer-create').hide();
            } else {
                //$('#checkout-customer-create_clone').remove();
                //$('#checkout-customer-create').show();
            }

            return false; // Stop execution of other handlers
        }
    });
    $(document).on('click', '#checkout-customer-create_clone', function (event) {
        var mobileNumber = $('#field_27').val();
        // Updated validation pattern to enforce country code (e.g., +61)
        var phonePattern = /^\+[1-9]\d{1,14}$/; // Must start with '+' followed by 1-15 digits
    
        if (!phonePattern.test(mobileNumber)) {
            event.preventDefault(); // Prevent form submission
            alert('Please enter a valid mobile number with the country code, e.g., +61.'); // Alert user
            $('#field_27').focus(); // Focus on the mobile number field
        } else {
            $('#checkout-customer-create_clone').remove(); // Remove the cloned button
            $('#checkout-customer-create').show(); // Show the original submit button
            $('#checkout-customer-create').click();
        }
    });

</script>
{{/partial}}

{{> layout/empty}}
