{{inject 'passwordRequirements' settings.password_requirements}}
{{#partial "page"}}
    {{> components/common/breadcrumbs breadcrumbs=breadcrumbs}}
    <h1 class="page-heading">{{lang 'create_account.heading' }}</h1>

    <div class="account account--fixed">
        <div class="account-body">
            {{#if forms.create_account.error}}
                {{> components/common/alert-error forms.create_account.error}}
            {{/if}}
            {{#if settings.account_creation_enabled}}
                <form action="{{urls.auth.save_new_account}}" data-create-account-form method="post" class="form">
                    <div class="form-row form-row--half">
                        {{#each forms.create_account.account_fields }}
                            {{{dynamicComponent 'components/common/forms'}}}
                        {{/each}}
                        {{#each forms.create_account.address_fields }}
                            {{{dynamicComponent 'components/common/forms'}}}
                        {{/each}}
                        {{inject 'required' (lang 'common.required')}}
                        {{inject 'state_error' (lang 'errors.state_error')}}
                    </div>
                    {{{ forms.create_account.recaptcha.markup}}}
                    <div class="form-actions">
                        <input type="submit" class="button button--primary" value="{{lang 'forms.create_account.submit_value' }}" />
                    </div>
                </form>
            {{/if}}
        </div>
    </div>
{{{ footer.scripts }}}

<script type="text/javascript">
    var get_format_msg = '<p class="mobile_num_con">Mobile number with the country code, e.g., +61.</p>';
    $(document).on('keyup', '#FormField_27_input', function(event) {
        if($(this).parent().find('.mobile_num_con').length === 0) {
            $(this).after(get_format_msg);
        }
    });
    $(document).on('keyup', '#FormField_7_input', function(event) {
        if($(this).parent().find('.mobile_num_con').length === 0) {
            $(this).after(get_format_msg);
        }
    });
    $(document).on('submit', 'form', function(event) {
        var mobileNumber = $('#FormField_27_input').val();
        var phonePattern = /^\+?[1-9]\d{1,14}$/; // E.164 format validation
        
        if (!phonePattern.test(mobileNumber)) {
            event.preventDefault(); // Prevent form submission
            alert('Please enter a valid mobile number.'); // Alert user
            $('#FormField_27_input').focus(); // Focus on the mobile number field

            // Check if the clone button already exists
            if ($('#checkout-customer-create_clone').length === 0) {
                // Clone the Create Account button and modify it
                var cloneButton = $('<button>', {
                    id: 'checkout-customer-create_clone',
                    class: 'button button--primary optimizedCheckout-buttonPrimary',
                    text: 'Create Account',
                    type: 'button', // Ensure it's not of type submit
                });
                
                // Insert the cloned button after the original one
                $('.form-actions input[type="submit"]').after(cloneButton);
                $('.form-actions input[type="submit"]').hide();
            } else {
                //$('#checkout-customer-create_clone').remove();
                //$('#checkout-customer-create').show();
            }

            return false; // Stop execution of other handlers
        }
    });
    $(document).on('click', '#checkout-customer-create_clone', function (event) {
        var mobileNumber = $('#FormField_27_input').val();
        // Updated validation pattern to enforce country code (e.g., +61)
        var phonePattern = /^\+[1-9]\d{1,14}$/; // Must start with '+' followed by 1-15 digits
    
        if (!phonePattern.test(mobileNumber)) {
            event.preventDefault(); // Prevent form submission
            alert('Please enter a valid mobile number with the country code, e.g., +61.'); // Alert user
            $('#FormField_27_input').focus(); // Focus on the mobile number field
        } else {
            $('#checkout-customer-create_clone').remove(); // Remove the cloned button
            $('.form-actions input[type="submit"]').show(); // Show the original submit button
            $('.form-actions input[type="submit"]').click();
        }
    });

</script>

{{/partial}}
{{> layout/base}}
